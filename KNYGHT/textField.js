define(["jquery","jqueryUI"],function(e){e.widget("pp.textField",{_create:function(){this._getElements(),this._addListeners(),this._load()},_getElements:function(){this.elements={},this.elements.parent=this.element,this.elements.input=this.element.find("input, textarea"),this.elements.helpErrors=this.element.find(".help-error"),this.elements.helpInformation=this.element.find(".help-information")},_addListeners:function(){this.elements.input.bind("focus",e.proxy(this._focus,this)),this.elements.input.bind("blur",e.proxy(this._blur,this)),this.elements.input.bind("complete",e.proxy(function(){this.closeBubble();var e=this.elements.input[0],t=this.validateField(e);t.valid?(this.elements.parent.removeClass("hasError"),this.elements.input.attr("aria-invalid","false")):(this.elements.parent.addClass("hasError"),this.elements.input.attr("aria-invalid","true"))},this)),this.elements.input.bind("error",e.proxy(this.openError,this))},_load:function(){this.elements.input.val()?this.elements.input.addClass("userText"):this.elements.input.removeClass("userText")},_blur:function(){this._load(),this.closeBubble();var t=this.elements.input[0],n=this.validateField(t);this._emptyFieldRule(n)},_emptyFieldRule:function(t){!t.valid&&t.error!=="valueMissing"?(this.elements.parent.addClass("hasError"),this.elements.input.attr("aria-invalid","true")):(this.elements.parent.removeClass("hasError"),this.elements.input.attr("aria-invalid","false"))},_focus:function(t){this.closeAllBubble(),hasErrors=this.elements.parent.hasClass("hasError"),hasErrors?this.openError():this.openHelp()},openError:function(){var t=this.elements.input.attr("id");t&&t.length>0&&this.elements.input.attr("aria-describedby",t+"-help-error"),this.elements.helpErrors.addClass("open"),this.elements.parent.addClass("focus")},openHelp:function(t){var n=this.elements.input.attr("id");n&&n.length>0&&this.elements.input.attr("aria-describedby",n+"-help-information"),this.elements.helpInformation.addClass("open"),this.elements.parent.addClass("focus")},closeBubble:function(){var t=this.elements.input.attr("id");t&&t.length>0&&this.elements.input.removeAttr("aria-describedby"),this.elements.helpErrors.removeClass("open"),this.elements.helpInformation.removeClass("open"),this.elements.parent.removeClass("focus")},closeAllBubble:function(){e("p.open, div.open").removeClass("open"),this.elements.parent.removeClass("focus")},validateField:function(n){if(n&&e(n).data("skip-validate"))return{valid:!0};if(n.checkValidity){if(!n.checkValidity()){var r="";for(r in n.validity)if(n.validity[r]===!0&&r!=="valid")return{valid:!1,error:r}}}else{validity={valueMissing:this.processRequired(),typeMismatch:!0,patternMismatch:this.processPattern(),rangeUnderflow:!0,rangeOverflow:!0,customError:!0};if(!validity.valueMissing)return{valid:!1,error:"valueMissing"};if(!validity.patternMismatch)return{valid:!1,error:"patternMismatch"}}return{valid:!0}},processRequired:function(){if(typeof this.elements.input.attr("required")!="undefined"){var n=this.elements.input.val();return n!=null&&e.trim(n).length>0?!0:!1}return!0},processPattern:function(){var t=this.elements.input;if(!t.attr("pattern"))return!0;var n=new RegExp("^"+t.attr("pattern")+"$");return n.test(t.val())}})});
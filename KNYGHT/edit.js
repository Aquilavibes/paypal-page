define(["jquery","underscore","backbone","view/settings/index","widgets/modal","widgets/validateForm","model/settings/address","collection/settings/address","view/settings/ppcAssetLight","utils","core/fpti","textField","lap","nativeDropdown","widgets/checkbox","backboneSyphon"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";var c=r.extend({el:"#overpanel",pageGrp:"settings:address",template:"settings/address/edit",events:{"submit form[name=editAddress]":"saveAddress","change #state":"addressStateChanged"},initialize:function(t){this.options=t},initWidgets:function(){this.$(".textInput").lap().textField(),this.$(".ppCheckbox").checkbox(),this.$(".selectDropdown").nativeDropdown(),this.formView=new s({el:"form[name=editAddress]"})},afterRoute:function(){this.creditData=e("#ppc_credit").data("credit"),this.model=u.findWhere({id:this.options.id});var n=e("#addressMainWrapper").data("address");this.model.set("entryMetadata",n.address.entryMetadata),i.setContent(this)},afterRender:function(){this.initWidgets()},saveAddress:function(t){var n={line1:this.$el.find("input[name=line1]").val(),line2:this.$el.find("input[name=line2]").val(),city:this.$el.find("input[name=city]").val()||this.$el.find("select[name=city]").val(),country_code:this.$el.find("input[name=country]").val()||"US",postal_code:this.$el.find("input[name=postalCode]").val(),state:this.$el.find("input[name=state]").val()||this.$el.find("select[name=state]").val()};n.state=n.state==="-1"?"":n.state,t.preventDefault(),l.init(),l.startModuleLoadTimer(),this.listenToOnce(this.model,"error",this.submitError),this.listenToOnce(this.model,"sync",this.onAddressUpdate),this.model.set(n),this.model.set({id:this.options.id}),this.model.save(),this.toggleLoading(!0)},isNewState1099KCompliant:function(t){var n=["VT","MA"];return n.includes(t.trim().toUpperCase())},addressStateChanged:function(t){this.model.get("previousState")||this.model.set("previousState",this.model.get("state")),this.model.get("previousState")===t.target.value||!this.isNewState1099KCompliant(t.target.value)?this.showOrHideStateChangeWarning(!1):this.showOrHideStateChangeWarning(!0)},showOrHideStateChangeWarning:function(t){t?this.$("#stateChangeWarningDiv").css("display","flex"):this.$("#stateChangeWarningDiv").css("display","none")},submitError:function(t,n,r){this.toggleLoading(!1),this.formView.showError(r)},onAddressUpdate:function(t){var n=this;l.recordModuleLoadTime(n.pageGrp+":edit",n.pageGrp,n.template+".dust"),u.reset(u.toJSON()),this.toggleLoading(!1);if(this.creditData&&this.creditData.type==="ppc"){var r=new a({overlay:"address",creditData:this.creditData});i.setContent(r)}else i.hideModal()},updateAddressModel:function(t){var n;return t.business?n=0:n=1,{id:t.id,address_type:n,addressLine1:{id:"line1",value:t.line1},addressLine2:{id:"line2",value:t.line2},city:{id:"city",value:t.city},state:{id:"state",value:t.state},zipcode:{id:"postalCode",value:t.postal_code},countryCode:t.country_code,primary:t.primary,billing:t.billing,confirmed:t.confirmed,cardList:t.cardList,paypalCredit:t.paypalCredit,entryMetadata:t.entryMetadata,displayMetadata:t.displayMetadata}},serialize:function(){var t=this.updateAddressModel(this.model.toJSON());return f.isSubPage("address")&&(t.lastUrl="settings/address"),t}});return c});